#! /usr/bin/env bash
# Tunnel to a riffremote site, make a backup of the riffdata mongo database, kill the tunnel

MONGO_ARCHIVES=(
                mongodb_riff-test.RR.boldly-app.backup-20200707143621.gz
                mongodb_riff-test.RR.clarovc.backup-20200707143648.gz
                mongodb_riff-test.RR.digital-leaders.backup-20200707143709.gz
                mongodb_riff-test.RR.disneyteam.backup-20200707143803.gz
                mongodb_riff-test.RR.esme.backup-20200707143821.gz
                mongodb_riff-test.RR.guo-ourteam.backup-20200707143849.gz
                mongodb_riff-test.RR.isg-trial.backup-20200707143914.gz
                mongodb_riff-test.RR.kevin-riff.backup-20200707143940.gz
                mongodb_riff-test.RR.leadershipteam.backup-20200707144004.gz
                mongodb_riff-test.RR.learningseeds.backup-20200707144025.gz
                mongodb_riff-test.RR.learnlaunch.backup-20200707144053.gz
                mongodb_riff-test.RR.loughtec.backup-20200707144117.gz
                mongodb_riff-test.RR.manpower.backup-20200707144157.gz
                mongodb_riff-test.RR.mcc-cec-team.backup-20200707144216.gz
                mongodb_riff-test.RR.meet.backup-20200707144237.gz
                mongodb_riff-test.RR.mg.backup-20200707144256.gz
                mongodb_riff-test.RR.mikecardus.backup-20200707144330.gz
                mongodb_riff-test.RR.movementteam.backup-20200707144352.gz
                mongodb_riff-test.RR.my.backup-20200707143545.gz
                mongodb_riff-test.RR.olin.backup-20200707144415.gz
                mongodb_riff-test.RR.opswat-emea.backup-20200707144435.gz
                mongodb_riff-test.RR.ptizzza.backup-20200707144458.gz
                mongodb_riff-test.RR.riffai.backup-20200707143210.gz
                mongodb_riff-test.RR.sew.backup-20200707144527.gz
                mongodb_riff-test.RR.strategyteam.backup-20200707144545.gz
                mongodb_riff-test.RR.surfx.backup-20200707144607.gz
                mongodb_riff-test.RR.swedishdoulas.backup-20200707144641.gz
                mongodb_riff-test.RR.teamstratcap.backup-20200707144750.gz
                mongodb_riff-test.RR.teamwoco.backup-20200707144841.gz
                mongodb_riff-test.RR.ude-vet.backup-20200707144856.gz
                mongodb_riff-test.RR.wiwin-homeschooling.backup-20200707144919.gz
               )

for archive in ${MONGO_ARCHIVES[@]}
do
    echo "Analyzing meetings in riffdata archive '$archive'..."

    SITE_NAME=${archive#mongodb_riff-test.RR.}
    SITE_NAME=${SITE_NAME%%.backup-*}

    ./analyze-data drop-riffdata-db
    bin/mongo-restore.sh $archive
    ./analyze-data meetings -R summary-attendees > reports/meetings-${SITE_NAME}_2020-07-07.rpt

    echo "...Finished Analyzing meetings in riffdata archive '$archive'"
    echo
done

